# QFW - qFibre Firewall Manager Configuration
# Complete configuration file with all available options

# ==============================================================================
# CONFIGURATION NOTES:
# ==============================================================================
#
# Time Duration Formats:
# - Use Go duration format: 1h, 30m, 45s, 1h30m, etc.
# - Examples: 5m (5 minutes), 1h (1 hour), 24h (24 hours)
#
# IP Address Formats:
# - Single IPs: 192.168.1.100
# - CIDR ranges: 192.168.1.0/24, 10.0.0.0/8
# - Multiple entries: comma-separated
#
# Log File Paths:
# - Absolute paths required
# - Wildcards supported in some contexts: /var/log/nginx/*/access.log
# - Multiple files: comma-separated
#
# Service Rules (when enable_per_service_rules=true):
# - SSH service: Controls SSH access
# - Web service: Controls HTTP/HTTPS access  
# - cPanel service: Controls cPanel/WHM access
# - DirectAdmin service: Controls DirectAdmin access
# - Mail service: Controls mail server access
# - FTP service: Controls FTP access
#
# Country Codes:
# - Use ISO 3166-1 alpha-2 codes (US, CA, GB, DE, FR, etc.)
# - Common blocked countries: CN, RU, KP, IR, PK, BD
#
# Default Ports Reference:
# - SSH: 22
# - HTTP: 80
# - HTTPS: 443
# - DNS: 53 (TCP/UDP)
# - NTP: 123 (UDP)
# - SMTP: 25, 587, 465
# - POP3: 110, 995
# - IMAP: 143, 993
# - FTP: 21
# - Telnet: 23 (better to be blocked)
# - RDP: 3389 (should be blocked on public interfaces)
#
# Security Recommendations:
# - Keep default_policy=drop for maximum security
# - Enable IPS with appropriate thresholds
# - Configure email/webhook notifications
# - Use test mode when making significant changes
# - Regularly update GeoIP databases
# - Monitor logs and adjust thresholds as needed
# - Keep whitelist updated with trusted IPs
#
# ==============================================================================

[firewall]
# Basic firewall settings
default_policy=drop
enable_ipv6=true

# IP Lists (comma-separated)
whitelist=127.0.0.1,10.0.0.0/8,192.168.1.0/24
blacklist=

# Port configuration
allowed_ports=22,80,443,53,123,993,995,465,587
blocked_ports=23,135,139,445,1433,3389,137,138,161,1434

[server]
# HTTP API Server settings
address=localhost
port=8080
read_timeout=10s
enable_api=true

[ips]
# Intrusion Prevention System
enabled=true
log_check_interval=30s
block_duration=1h
failure_threshold=5
time_window=5m

# Log files to monitor (comma-separated)
log_files=/var/log/auth.log,/var/log/secure,/var/log/apache2/access.log,/var/log/nginx/access.log

# GeoIP blocking
enable_geo_blocking=false
blocked_countries=CN,RU,KP,IR

# cPanel specific settings
cpanel_failed_logins=3
cpanel_time_window=5m
cpanel_log_files=/usr/local/cpanel/logs/login_log,/usr/local/cpanel/logs/access_log

# DirectAdmin specific settings
directadmin_failed_logins=3
directadmin_time_window=5m
directadmin_log_files=/var/log/directadmin/security.log,/var/log/directadmin/login.log

# WordPress specific settings
wordpress_failed_logins=5
wordpress_time_window=5m

# Apache/Nginx log monitoring
apache_log_files=/var/log/apache2/access.log,/var/log/httpd/access_log,/home/*/logs/access.log
nginx_log_files=/var/log/nginx/access.log,/var/log/nginx/*/access.log

# Mail server monitoring
mail_log_files=/var/log/mail.log,/var/log/maillog,/var/log/postfix.log

# FTP server monitoring
ftp_log_files=/var/log/vsftpd.log,/var/log/proftpd/proftpd.log

# System auth logs
auth_log_files=/var/log/auth.log,/var/log/secure

# Advanced IPS features
enable_block_notifications=true
notify_cpanel_blocks=true
notify_web_blocks=true
notification_cooldown=5m

# Auto-whitelist SSH sessions to prevent lockout
auto_whitelist_ssh_sessions=true
ssh_whitelist_duration=24h

# Permanent block threshold (after X temp blocks, make permanent)
perm_block_threshold=3

# Port scan detection
enable_port_scan_detection=true
port_scan_threshold=10
port_scan_time_window=1m

# File system monitoring
enable_filesystem_monitor=true
critical_files=/etc/passwd,/etc/shadow,/etc/sudoers,/etc/hosts,/etc/ssh/sshd_config,/etc/crontab,/root/.ssh/authorized_keys
critical_directories=/bin,/sbin,/usr/bin,/usr/sbin
file_check_interval=5m

# Process monitoring
enable_process_monitor=true
suspicious_process_patterns=perl /tmp/.*\.pl,php.*mailer,wget http.*\.php,curl.*\.sh,python.*backdoor,nc -l.*,/tmp/.*\.py,bash.*reverse,sh.*shell,.*\.php.*system
max_process_memory=1GB
process_check_interval=1m

# External blocklists
enable_external_blocklists=true
spamhaus_enabled=true
dshield_enabled=true
blocklist_update_interval=24h

[monitor]
# System resource monitoring
enabled=true
check_interval=30s

# CPU monitoring
cpu_threshold=80.0
cpu_duration=5m

# Memory monitoring
mem_threshold=80.0

# Disk monitoring
disk_threshold=85.0

[geoip]
# GeoIP database configuration
mmdb_path=/etc/qfw/GeoLite2-Country.mmdb
country_block_file=/etc/qfw/countries.block
country_allow_file=/etc/qfw/countries.allow
maxmind_api_key=YOUR_MAXMIND_LICENSE_KEY
auto_download=false

# Enhanced GeoIP features
enable_per_service_rules=false
enable_vpn_detection=false
vpn_detection_api=ipqualityscore
vpn_api_key=
vpn_blocklists=https://raw.githubusercontent.com/X4BNet/lists_vpn/main/ipv4.txt,https://raw.githubusercontent.com/platformbuilds/Tor-IP-Addresses/refs/heads/master/tor-exit-nodes.lst
cache_vpn_results=true
cache_expiration=24h

# Service-specific GeoIP rules (requires enable_per_service_rules=true)
# Format: service_name_allowed_countries or service_name_blocked_countries
ssh_allowed_countries=US,CA,GB,DE,FR,AU,JP
ssh_blocked_countries=
ssh_block_vpns=true
ssh_block_proxies=true

web_allowed_countries=
web_blocked_countries=CN,RU,KP,IR
web_block_vpns=false
web_block_proxies=false

cpanel_allowed_countries=US,CA,GB
cpanel_blocked_countries=
cpanel_block_vpns=true
cpanel_block_proxies=true

[dns]
# Dynamic DNS support
enable_dynamic_dns=false
hostnames=
update_interval=5m

[ratelimit]
# Connection rate limiting
enable_rate_limit=false
global_conn_limit=100
global_conn_window=1m
port_specific_limits=22:5/1m:tcp,80:50/1m:tcp,443:50/1m:tcp

[synflood]
# SYN flood protection
enable_protection=false
syn_rate_limit=10
syn_burst=5
conntrack_max=100

[security]
# Enhanced security features
enable_bogon_filter=false
enable_martian_filter=false
bogon_update_interval=24h
bogon_ipv4_url=https://www.team-cymru.org/Services/Bogons/fullbogons-ipv4.txt
bogon_ipv6_url=https://www.team-cymru.org/Services/Bogons/fullbogons-ipv6.txt

[notification]
# Email notifications
enable_email=false
email_server=smtp.gmail.com
email_port=587
email_user=your-email@gmail.com
email_password=your-app-password
email_to=admin@yourdomain.com

# Webhook notifications (Slack, Discord, etc.)
enable_webhooks=false
webhook_urls=https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK
webhook_timeout=10

[testmode]
# Safe testing mode - automatically reverts changes if connectivity is lost
enable_test_mode=false
test_duration=5m
revert_on_failure=true
test_connections=8.8.8.8,1.1.1.1,google.com

[ports]
# Detailed port configuration (legacy format for compatibility)
tcp_in=22,80,443
tcp_out=53,80,443,993,995,465,587
udp_in=53,123
udp_out=53,123

# Explicitly denied ports
tcp_deny=23,135,139,445,1433,3389
udp_deny=137,138,161,1434
